---
title: MySQL事务
date: 2022-07-13 19:25:47
permalink: /pages/f0d732/
categories:
  - 计算机基础
  - MySQL
tags:
  - 
author: 
  name: Marvel
  link: https://github.com/zouquchen
---
# MySQL事务

#### 1 什么是事务？

事务是一逻辑上的一组操作，要么都执行，要么都不执行？

> 举一个例子：转账
>
> 假如小明要给小红转1000元，那么转账操作会设计以下两个操作：
>
> 1 小明余额减少1000元
>
> 2 小红余额增加1000元。
>
> 事务会把两个操作堪称逻辑上的一个整体，这个整体包含的操作要么都成功，要么都失败。不会出现小明余额减少，而小红余额却没有增加的情况。要保证数据库的一致性。

mysql开启事务操作

```sql
START TRANSACTION;
事务代码
commit;
```

#### 2 什么是数据库事务？

对于单体架构，没有特指分布式事务的话，那么指的就是数据库事务。

数据库事务可以保证多个对数据库的操作构成一个逻辑上的整体，构成这个逻辑上的整体的这些数据库操作遵循：要么全部执行成功，要么全部不执行。

#### 3 MYSQL的隔离级别？

- 读未提交（Read Uncommited，RU）：事务A可以读取到事务B中未提交的数据，脏读数据。
- 读已提交（Read Committed，RC）：事务A可以读取到事务B已提交的数据，会导致不可重复读和幻读
- 可重复读（Repeatable Read，RR）：事务A开启后，不管多久，事务A读取的数据都是一致的，即使事务B已经修改。只是一定程度上避免了幻读（一开始读取数据可能有4条，再次读取时可能增减会减少了）（默认级别）
- 串行化：效率低，解决所有问题；事务排队不能并发。

> 在PR隔离级别下，使用间隙锁（Gap Lock）理论上可以防止幻读的发生，但是不能完全防止。

#### 4 并发事务造成的问题：

- 脏读（Dirty read）：事务A读取到事务B中未提交的数据
- 丢失修改（Lost to modify）：事务A修改数据的同时，事务B也修改数据，事务A提交数据后，事务B也提交数据，事务B修改的数据会将数据A给覆盖。
- 不可重复度（Unrepeatable read）：事务A开启后，读取小明 15岁，此时开启事务B对小明年龄进行修改，事务A再次读取小明年龄为18.
- 幻读（Phantom read）：与不可重复的类似，读取的数据可能为3条。此时开启事务B增删数据并提交，事务A再次读取数据为2或4条，出现前后不一致的现象。

#### 5 事务的4个特性ACID：

- A：原子性（Atomicity）：事务是最小的执行单位，不可分割。要么全部完成，要么全部不起作用。
- C：一致性（Consistency）：在事务开始之前和事务结束以后，数据库的完整性没有被破坏。这表示写入的资料必须完全符合所有的预设约束、触发器、级联回滚等。
- I：隔离性（Isolation）：多个用户并发访问数据库时，数据库为每一个用户开启的事务，不能被其他事务的操作数据所干扰，多个并发事务之间要相互隔离。
- D：持久化（Durability）：⼀个事务被提交之后。它对数据库中数据的改变是持久的，即使数据库发生故障也不应该对其有任何影响

#### 6 事务可以嵌套吗？

可以，因为嵌套事务可以是总舵事务分类中的一种，它是一个层次结构框架。有一个顶层事务控制着各个层次的事务，顶层事务之下嵌套的事务被称为子事务，它控制每一个局部的变换。

MYSQL数据库不支持嵌套事务。