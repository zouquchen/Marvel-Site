---
title: TodoList案例
date: 2023-08-21 19:22:27
permalink: /pages/b66dab/
categories:
  - 前端
  - 框架
  - React
tags:
  - 前端
  - React
author: 
  name: Marvel
  link: https://github.com/zouquchen
---



# TodoList案例

展示效果：

<img src="https://raw.githubusercontent.com/zouquchen/Images/main/Ob-Vault/2023image-20230821171217951.png" alt="image-20230821171217951" style="zoom: 33%;" />

拆分组件：将整个应用拆成多个组件

- Header：页眉输入框
- List：列表展示
- Item：列表中的每一项
- Footer：页脚部分



## 安装库

```cmd
npm i nanoid            # 用于产生唯一id
npm i prop-types		# 用于限制props类型、必要性
```

## 相关知识点

1. 拆分组件、实现静态组件，注意：className、style 的写法
2. 动态初始化列表，如何确定将数据放在哪个组件的 state 中？
   - 某个组件使用：放在自身的state中
   - 某些组件使用：放在他们共同的父组件 state 中（官方称此操作为：状体提升）
3. 关于父子之间通信：
   - 【父组件】给【子组件】传递数据：通过props传递
   - 【子组件】给【父组件】传递数据：通过props传递，要求父组件提前给子组件传递一个函数
4. 注意 defaultChecked 和 checked的区别，类似的还有：defaultvalue 和 value
5. 状态在哪里，操作状态的方法就在哪里

## 代码

css样式代码省略了

`src/App.jsx`

```jsx
import React,{Component} from 'react'
import Header from './components/Header'
import Footer from './components/Footer'
import List from './components/List'
import './App.css'


export default class App extends Component{
  // 状态在哪里，操作状态的方法就在哪里

  // 初始化状态
  state = {todos:[
      {id:'001', name:'吃饭', done:true},
      {id:'002', name:'睡觉', done:true},
      {id:'003', name:'工作', done:false},
      {id:'004', name:'逛街', done:false},
  ]}
  // 用于添加todo，接受参数是todo对象
  addTodo = (todoObj) => {
    const {todos} = this.state
    const newTodos = [todoObj,...todos]
    this.setState({todos:newTodos})
  }
  // 用于更新一个TODO对象
  updateTodo = (id, done) => {
    const {todos} = this.state
    // 匹配处理数据
    const newTodos = todos.map((todoObj)=>{
      if(todoObj.id === id) return {...todoObj,done}
      else return todoObj
    })
    this.setState({todos:newTodos})
  }
  // 用于删除一个todo对象
  deleteTodo = (id) => {
    const {todos} = this.state
    const newTodos = todos.filter((todoObj) => {
      return todoObj.id !== id
    })
    this.setState({todos:newTodos})
  }
  // 全选todo对象
  checkAllTodo = (done) => {
    const {todos} = this.state
    const newTodos = todos.map((todoObj)=>{
      return {...todoObj, done:done}
    })
    this.setState({todos:newTodos})
  }
  // 清除所有已完成
  clearAllDone = () => {
    const {todos} = this.state
    const newTodos = todos.filter((todoObj)=>{
      return !todoObj.done
    })
    this.setState({todos:newTodos})
  }
  render(){
    return (
      <div className='todo-container'>
        <Header addTodo={this.addTodo}/>
        <List todos={this.state.todos} updateTodo={this.updateTodo} deleteTodo={this.deleteTodo}/>
        <Footer todos={this.state.todos} checkAllTodo={this.checkAllTodo} clearAllDone={this.clearAllDone}/>
      </div>
    )
  }
}
```

`src/components/Footer/index.jsx`

```jsx
import React, { Component } from 'react'
import PropTypes from 'prop-types'
import './index.css'

export default class Footer extends Component {
  // 对接收的props进行类型、必要性的限制
  static propTypes = {
    addTodo:PropTypes.func.isRequired
  }
  handleCheckAll = (event) => {
    this.props.checkAllTodo(event.target.checked)
  }
  handleClearAllDone = () => {
    this.props.clearAllDone()
  }
  render() {
    const {todos} = this.props
    const doneCount = todos.reduce((pre, cur) => {
      return pre + (cur.done ? 1 : 0)
    }, 0)
    const total = todos.length
    return (
      <div className='todo-footer'>
        <label>
          <input type='checkbox' onChange={this.handleCheckAll} checked={doneCount === total && total !== 0 ? true : false} />
        </label>
        <span>
          <span>已完成{doneCount}</span> / 全部{total}
        </span>
        <button onClick={this.handleClearAllDone} className="btn btn-danger">清除已完成任务</button>

      </div>
    )
  }
}
```

`/src/components/Header/index.jsx`

```jsx
import React, { Component } from 'react'
import PropTypes from 'prop-types'
import {nanoid} from 'nanoid'
import './index.css'

export default class Header extends Component {
  // 对接收的props进行类型、必要性的限制
  static propTypes = {
    addTodo:PropTypes.func.isRequired
  }

  handleKeyUp = (event) => {
    // 结构赋值，回车是13
    const {keyCode, target} = event
    // 判断是否为回车按键
    if (keyCode !== 13) return
    // 添加的todo名字不能为空
    if (target.value.trim() === ''){
      alert('输入不能为空')
      target.value = ''
      return
    }
    // 准备好todo对象
    // npm install nanoid,通过nanoid生成唯一的id
    const todoObj = {id:nanoid(),name:target.value,done:false}
    // 子组件给父组件，通过调用父组件的函数
    this.props.addTodo(todoObj)
    // 清空输入
    target.value = ''
  }

  

  render() {
    return (
      <div className="todo-header">
        <input onKeyUp={this.handleKeyUp} type="text" placeholder='请输入你的任务名称，按回车键确认' />
      </div>
    )
  }
}
```

`/src/components/Item`

```jsx
import React, { Component } from 'react'
import PropTypes from 'prop-types'
import './index.css'

export default class Item extends Component {
  // 对接收的props进行类型、必要性的限制
  static propTypes = {
    updateTodo:PropTypes.func.isRequired,
    deleteTodo:PropTypes.func.isRequired
  }
  state = {mouse:false}
  // 鼠标移入移除回调
  handleMouse = (flag) => {
    return () => {
      this.setState({mouse:flag})
    }
  }
  // 勾选或取消勾选
  handleCheck = (id) => {
    return (event)=> {
      this.props.updateTodo(id, event.target.checked)
    }
  }
  // 删除一个tod （不用高阶函数实现）
  handleDelete = (id) => {
    if (window.confirm('确认删除吗？')){
      this.props.deleteTodo(id)
    }
  }
  render() {
    const {id,name,done} = this.props
    const {mouse} = this.state
    return (
      <li style={{background:mouse ? "#ddd" : "white"}} onMouseEnter={this.handleMouse(true)} onMouseLeave={this.handleMouse(false)}>
        <label>
          <input type='checkbox' checked={done} onChange={this.handleCheck(id)}/>
          <span>{name}</span>
        </label>
        <button onClick={() => {this.handleDelete(id)}} className='btn btn-danger' style={{display:mouse?'block':'none'}}>删除</button>
      </li>
    )
  }
}
```

`/src/components/List`

```jsx
import React, { Component } from 'react'
import PropTypes from 'prop-types'
import Item from '../Item'
import './index.css'

export default class List extends Component {
  // 对接收的props进行类型、必要性的限制
  static propTypes = {
    todos:PropTypes.array.isRequired,
    updateTodo:PropTypes.func.isRequired,
    deleteTodo:PropTypes.func.isRequired
  }
  render() {
    const {todos} = this.props
    return (
      <ul className="todo-main">
        {
          todos.map((todo) => {
            return <Item key={todo.id} {...todo} updateTodo={this.props.updateTodo} deleteTodo={this.props.deleteTodo}/>
          })
        }
      </ul>
    )
  }
}
```

